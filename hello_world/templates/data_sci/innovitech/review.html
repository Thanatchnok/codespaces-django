{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="{% static 'review.css' %}" />
    <meta charset="utf-8" />
    <link rel="icon" href="{% static 'favicon.ico' %}" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <title>Innovitech</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro%3A200%2C400" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Manrope%3A200" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mouse+Memoirs%3A400" />
</head>
<style>
    body {
    overflow-x: hidden; 
    }
    
    .menu button {
        width: 155px;
        height: 41px;
        font-size: 20px;
        font-weight: bold;
        color: blue;
        background-color: white; 
        cursor: pointer;
    }

    .menu button:hover {
        background-color: #f0f0f0; 
    }

    .movie button {
        width: 155px;
        height: 41px;
        font-size: 20px;
        font-weight: bold;
        color: blue;
        background-color: white; 
        cursor: pointer;
    }

    .movie button:hover {
        background-color: #f0f0f0; 
    }

    .tv-show button {
        width: 155px;
        height: 41px;
        font-size: 20px;
        font-weight: bold;
        color: blue;
        background-color: white; 
        cursor: pointer;
    }

    .tv-show button:hover {
        background-color: #f0f0f0; 
    }
    .overlap {
        text-align: center;
        margin-left: 100px;

    }
</style>

<body>
    
    <div class="desktop-myblog">

        <div class="div">
            <div class="overlap">
                <header class="header">

                    <div class="movie" style="width: 155px; height: 41px;">
                        <a href="{% url 'blog' %}">
                          <button
                            style="width: 100%; height: 100%; font-size: 20px; font-weight: bold; color: blue;">MyBlog</button>
                        </a>
                      </div>
          
                      <div class="menu" style="width: 155px; height: 41px;">
                        <a href="{% url 'timeline' %}">
                          <button
                            style="width: 100%; height: 100%; font-size: 20px; font-weight: bold; color: blue;">Timeline</button>
                        </a>
                      </div>
          
                      <div class="tv-show" style="width: 100px; height: 41px;">
                        <a href="{% url 'homepage' %}">
                          <button
                            style="width: 100%; height: 100%; font-size: 20px; font-weight: bold; color: blue;">Home</button>
                        </a>
                      </div>
          

                </header>
                <div class="profile"><img class="ellipse" src="{% static 'img/ellipse-4-1.png' %}" /></div>
                <div class="search"></div>
                <div class="search-2">
                    <input class="search-name-list-of" style="font-family: Arial, Helvetica, sans-serif; margin-top: -10px;" placeholder="Search Name list of movie" type="text" />
                    <img class="search-item" src="{% static 'img/search-item.svg' %}" />
                </div>
                <div class="text-wrapper" style="font-family: Arial, Helvetica, sans-serif; margin-left: 100px;">Innovitech</div>
                <img class="logo" src="{% static 'img/logo.png' %}" />
                

            </div>
            <img class="text-box" src="{% static 'img/text-box-2.png' %}" />
            <img class="img" src="{% static 'img/text-box-2.png' %}" />
        </div>
    </div>

    <div class="desktop-review" id="page">
        <div class="frameofbody" id="borderframe">
            <div class="Showarea" id="frameofshowmovie">
                <img class="Picmovie" src="{% static 'img/fivenight.jpg' %}" id="fivenightspic" />
                <div class="rightframetop" id="frameofrighttop">
                    <div class="textrighttopframe" style="margin-right: 20px;" id="frametexttop">
                        <p class="text1" style="font-size: 48px;" id="text1">Five Nights At Freddy’s</p>
                    </div>
                    <div class="rightframebelow" style="margin-left: 10px;" id="frametoptex">
                        <img class="picchosenone" src="{% static 'img/picchosenone.png' %}" id="chosenone" />
                        <img class="picpopcorn" src="{% static 'img/popcorn.png' %}" id="popcorn" />
                        <div class="textrightbelowframe2" id="framebelowtext">


                        </div>
                    </div>
                </div>
            </div>

            <div class="add_comment">
                <div class="rowuser">
                    <img class="userimg" src="{% static 'img/ellipse-4-1.png' %}" width="50" height="50">
                    <h2>Comment Section</h2>
                </div>
                <div>
                    <input id="field1" placeholder="Add comment..............." type="text">
                    <button id="addButton" onclick="addComment()" type="button">Sent</button>
                </div>
            </div>

            
            <div id="commentContainer">
                {% if comments %}
                {% for comment in comments %}
                <div class="comment">
                    <div class="profıle-ımage">
                        <p id="name">M</p>
                    </div>
                    <div class="username">Me</div>
                    <div class="user-comment">
                        <p>{{ comment.fields.text }}</p>
                        <button class="edit-comment-button" onclick="editComment(this)">Edit</button>
                        <button class="save-comment-button" onclick="saveComment(this)">Save</button>
                        <div style="clear:both;"></div>
                        <span>Just now</span>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>

            <div class="comment">
                <div class="profıle-ımage">
                    <p id="name">M</p>
                </div>
                <div class="username">Mony</div>
                <div class="user-comment">
                    <p>If you're a fan of the games, you'll likely enjoy this movie. It's a faithful adaptation that
                        successfully brings the tension and horror of Five Nights at Freddy's to the big screen.
                    </p>
                    <div style="clear:both;"></div>
                    <span>1 days ago</span>
                </div>
            </div>

            <div class="comment">
                <div class="profıle-ımage">
                    <p id="name">T</p>
                </div>
                <div class="username">The61</div>
                <div class="user-comment">
                    <p>One of the film's strongest points is its commitment to the source material. </p>
                    <div style="clear:both;"></div>
                    <span>1 days ago</span>
                </div>
            </div>

            <div class="comment">
                <div class="profıle-ımage">
                    <p id="name">P</p>
                </div>
                <div class="username">Peraya</div>
                <div class="user-comment">
                    <p>Good </p>
                    <div style="clear:both;"></div>
                    <span>1 days ago</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getCookie(name) {
            const cookieValue = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
            return cookieValue ? cookieValue.pop() : '';
        }
        function addComment() {
            const commentText = document.getElementById("field1").value;

            if (!commentText) {
                alert("Please enter a comment before submitting.");
                return;
            }

            fetch('/example/comment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ comment_text: commentText })
            })
                .then(response => {
                    if (response.ok) {
                        return response.json(); 8
                    }
                    throw new Error('Failed to add comment');
                })
                .then(data => {
                    
                    console.log('New comment added:', data);
                   
                })
                .catch(error => {
                    console.error('Error:', error);
                   
                });

            // Add new comment
            const newComment = document.createElement("div");
            newComment.classList.add("comment");

            newComment.innerHTML = `
                <div class="profıle-ımage">
                    <p id="name">M</p>
                </div>
                <div class="username">Me</div>
                <div class="user-comment">
                    <p>${commentText}</p>
                    <button class="edit-comment-button" onclick="editComment(this)">Edit</button>
                    <button class="save-comment-button" onclick="saveComment(this)">Save</button>
                    <div style="clear:both;"></div>
                    <span>Just now</span>
                </div>
            `;

            const commentContainer = document.getElementById("commentContainer");
            commentContainer.appendChild(newComment);

            document.getElementById("field1").value = "";
        }



        function editComment(button) {
            const commentText = button.previousElementSibling;
            const editButton = button;
            const saveButton = button.nextElementSibling;

            // Replace the comment text with a textarea for editing
            const textarea = document.createElement("textarea");
            textarea.value = commentText.textContent;
            commentText.replaceWith(textarea);

            // Show the "Save" button and hide the "Edit" button
            saveButton.style.display = "inline";
            editButton.style.display = "none";
        }

        function saveComment(button) {
            const commentText = button.previousElementSibling.previousElementSibling;
            const editButton = button.previousElementSibling;
            const saveButton = button;

            // Replace the textarea with a paragraph containing the edited text
            const newParagraph = document.createElement("p");
            newParagraph.textContent = commentText.value;
            commentText.replaceWith(newParagraph);

            // Show the "Edit" button and hide the "Save" button
            saveButton.style.display = "none";
            editButton.style.display = "inline";
        }
    </script>
</body>

</html>